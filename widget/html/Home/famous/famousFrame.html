<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../../../css/api.css"/>
      <style>
      img{
        width:100%;
      }

          ul{
            font-size:0;
            padding:0 10px;
            box-sizing:border-box;
          }
          li{

            font-size:12px;
            display: inline-block;
            box-sizing: border-box;
            width: 31%;
            text-align: center;
            margin:10px 1% 0;
            box-shadow: 0 0 2px #ccc;
          }
          li span{
            margin:7px 0;
            display: block;
            text-align: center;
          }
          ul{
            width:100%;
          }
      </style>
  </head>
  <body>
    <div class="cultureList">
      <ul>

      </ul>
    </div>
  </body>
  <script type="text/javascript" src="../../../script/api.js"></script>
  <script type="text/javascript" src="../../../script/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="../../../script/service.js"></script>
  <script type="text/javascript">
  var cur=1
  var url="http://116.62.170.181:8081"

  function errHandle(obj){
    $('img').bind('error',function(){
      $(this).attr('src','../../../image/default.png')
    })
    if(obj){
      $(obj).attr('src','../../../image/default.png')
    }
  }
  errHandle()
  function inner(id){
    api.openWin({
        name: 'content',
        url: '../../../html/Home/content.html',
        pageParam:{
          contentId:id,
          category:'history_celebrities',
          title:api.pageParam.title
        }
    });
  }

        apiready = function(){
          api.showProgress({
          title: '努力加载中...',
          text: '先喝杯茶...',
          modal: false
      });
          api.setCustomRefreshHeaderInfo({
          bgColor: '#eee',
          images: [
              'widget://image/refresh/dropdown0.png',
              'widget://image/refresh/dropdown1.png',
              'widget://image/refresh/dropdown2.png',
              'widget://image/refresh/dropdown3.png',
              'widget://image/refresh/dropdown4.png',
              'widget://image/refresh/dropdown5.png',
              'widget://image/refresh/dropdown6.png'
          ],
          tips: {
              pull: '下拉刷新',
              threshold: '松开立即刷新',
              load: '正在刷新'
          }
      }, function() {
        cur=1
          //下拉刷新被触发，自动进入加载状态，使用 api.refreshHeaderLoadDone() 手动结束加载中状态
          //下拉刷新被触发，使用 api.refreshHeaderLoadDone() 结束加载中状态
          getData('/history_celebrities?page='+cur+'page_size=20',function(data){
            api.hideProgress();
            $('.cultureList ul').html(" ")
            obj=$('.cultureList ul')
            if(data.data.length>=1){
              data.data.forEach(function(item){
                obj.append('<li onclick="inner('+item.id+')"><img src="'+url+item.avatar+'" onerror="errHandle(this)" alt=""><span>'+item.name+'</span></li>')
              })
            }
            else{
              return false
            }
            api.refreshHeaderLoadDone()

          },{"page":cur,"page_size":"20"},{"Authorization":$api.getStorage('token')})


      });

        getData('/history_celebrities',function(data){api.hideProgress();
          obj=$('.cultureList ul')
          data.data.forEach(function(item){
              obj.append('<li onclick="inner('+item.id+')"><img src="'+url+item.avatar+'" onerror="errHandle(this)" alt=""><span>'+item.name+'</span></li>')
          })
        },{},{"Authorization":$api.getStorage('token')})
      }

  </script>
  </html>
