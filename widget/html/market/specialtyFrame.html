<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css"/>

      <style>
          body{
          min-height:100vh;
          background-color: #f3f1f1;
          }
          .banner{
            width:100%;
            min-height:150px;
            padding-bottom:10px;
            background: -webkit-linear-gradient(to bottom,#41906d,#257350);
                  background: -o-linear-gradient(to bottom,#41906d,#257350);
                  background: -moz-linear-gradient(to bottom,#41906d,#257350);
                  background: -mos-linear-gradient(to bottom,#41906d,#257350);
                  background: linear-gradient(to bottom,#41906d,#257350);
          }
          .single{
            padding:0 10px;
            box-sizing: border-box;
            text-align: center;
            width:100%;
          }
          .single img{
            width:100%;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
          }
          .discountArea .tab {
            background-color: white;
          }
          .discountArea .tab ul{
            display: table;
            width:100%;
          }
          .discountArea .tab ul>li{
            padding-top: 12px;
            text-align: center;
            display: table-cell;
            font-size:14px;
          }
          .discountArea .tab ul>.active{
            border-bottom:2px solid #41906d;
            color:#41906d;
          }
          .discountArea .tab ul>li p{
            line-height: 32px;
          }
          .discountArea .tab ul>li img{
            width:35px;
          }


            .specialList{
              margin-top:10px;
            }
            .specialList  li>div{
              padding:15px 10px;
            }
            i{
              font-style:normal;
            }
              .specialList  li{
                background-color: white;
                border-bottom:1px solid #eee;
              }
            .specialList  li .info{
              vertical-align: top;
              width: 70%;
              margin-left:10px;
              display: inline-block;
            }
            @media screen  and (max-width: 320px) {
              .specialList  li .info{
                vertical-align: top;
                width: 60%;
                margin-left:10px;
                display: inline-block;
              }
            }
          .specialList  li img{
            width:75px;
          }
          .specialList  li .name{
            font-size:15px;
            line-height:25px
          }
            .specialList  li .price{
              margin-top:15px;
            }
            .specialList  li .price>span{
              font-size:12px;
              color:#ef5737;
            }
            .specialList  li .price del{
              font-size:12px;
              color:#999;

            }
            .specialList  li .price>span i{
              font-size: 16px;
            }
            .specialList  li .price b {
              font-size: 12px;
              font-weight: normal;
              float: right;
              color:#999;
            }
            .empty{
              margin-top:20px;
              text-align: center;
            }
            .empty img{
              width:100px;
            }
            .empty p{
              margin-top:10px;
            }
          [v-cloak]{
            display: none;
          }
          .header{
            background-color: white;
            width:100%;
            margin-top:10px;
          }
          .header ul{

            width:100%;
            white-space:nowrap;
            min-height:80px;
            overflow: auto;
          }
          .header ul li p{
            font-size:14px;
            text-align: center;
          }
          .header ul li:nth-child(1){
            margin-left:10px;
          }
          .header ul li{
          	line-height: 1.5;
          	vertical-align: top;
          		  border-collapse:collapse;
          	display: inline-block;
          	background-color: white;
          	width:86px;
          	padding:12px;
            box-sizing: border-box;
          	min-height:60px;
          }
          .header ul li p{
            margin-top:10px;
            white-space:nowrap;
            text-overflow:ellipsis;
            overflow: hidden;
          	font-size:10px;
          }
          .header ul li span{
          	font-size:15px;
          }
          .header ul li i {
          	font-size:12px;
          }
          .header ul li img{
          	width:100%;
            width:62px;
          }
          .header ul li >div{
            height:62px;
            text-align: center;
            overflow: hidden;

          }
      </style>
  </head>
  <body>
    <div class="discountArea" v-cloak>
      <div class="banner swiper-container">
          <div class="swiper-wrapper">

          </div>
      </div>
      <div class="tab">
        <ul>
          <li @click="navchange('brand')" v-bind:class="{active:active=='brand'}">
            <img v-if="active!='brand'" src="../../image/market/spegood.png" alt="">
            <img v-if="active=='brand'" src="../../image/market/acspegood.png" alt="">

            <p>今日推荐</p>
          </li>
          <li @click="navchange('discount')" v-bind:class="{active:active=='discount'}">
            <img v-if="active!='discount'" src="../../image/market/speline.png" alt="">
            <img v-if="active=='discount'" src="../../image/market/acspeline.png" alt="">

            <p>土特直供</p>
          </li>
          <li @click="navchange('special')" v-bind:class="{active:active=='special'}">
            <img v-if="active!='special'" src="../../image/market/spehot.png" alt="">
            <img v-if="active=='special'" src="../../image/market/acspehot.png" alt="">

            <p>最近热卖</p>
          </li>
        </ul>
      </div>
      <ul class="goodsList specialList" v-if="active=='brand'">
        <li v-for="item in aclist" @click="inner(item.id)">
          <div>
              <img v-bind:src="url+item.img" alt="">
                <div class="info">
                    <p class="name">{{item.name}}</p>
                    <p class="price">
                      <span>￥<i>{{item.sell_price}}</i></span>
                      <del>{{item.market_price}}</del>
                      <b >已售 {{item.sale}} 件</b>
                    </p>
                </div>
                </div>
        </li>
      </ul>
      <div class="header" v-if="active=='discount'">
        <ul>
          <li v-for="item in speList" @click="content(item.id)">
              <div>
              <img v-bind:src="url+item.img" alt="" :onerror="errorImg">
              </div>
              <p>{{item.name}}</p>
            </li>
        </ul>
      </div>
      <ul class="discountList specialList" v-if="active=='discount'">
        <li v-for="item in aclist" @click="inner(item.id)">
          <div>
              <img v-bind:src="url+item.img" alt="">
                <div class="info">
                    <p class="name">{{item.name}}</p>
                    <p class="price">
                      <span>￥<i>{{item.sell_price}}</i></span>
                      <del>{{item.market_price}}</del>
                      <b >已售 {{item.sale}} 件</b>
                    </p>
                </div>
                </div>
        </li>
      </ul>
      <ul class="specialList" v-if="active=='special'">
        <li v-for="item in aclist" @click="inner(item.id)">
          <div>
              <img v-bind:src="url+item.img" alt="">
                <div class="info">
                    <p class="name">{{item.name}}</p>
                    <p class="price">
                      <span>￥<i>{{item.sell_price}}</i></span>
                      <del>{{item.market_price}}</del>
                      <b >已售 {{item.sale}} 件</b>
                    </p>
                </div>
                </div>
        </li>
      </ul>
      <div class="empty" v-if="aclist.length<1">
        <p>暂无数据</p>
      </div>
    </div>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="../../script/service.js"></script>
  <script type="text/javascript" src="../../script/swiper-3.4.2.min.js"></script>
  <script type="text/javascript" src="../../script/vue.js"></script>

    <script type="text/javascript">
    function activityInner(id,type){
      let name
      switch (type) {
        case 1:////"1" =>店铺
          name="shopintro"
          break;
        case 2: ////"2" =>商品分类
          name="allGoods"
          break;
        case 3:
          name="goodsInner"
          break; //"3" =>商品单品
        case 4: //"4" =>商品品牌
          break
        case 5: ////"5" =>营销活动
          name="litmitGoods"
          break
      }
      api.openWin({
          name: name,
          url: '../../html/market/'+name+'Win.html',
          pageParam: {
              id: id
          }
      });

    }
    apiready = function(){
      // 融云模块
      var app=new Vue({
        el: '.discountArea',
        data: {
          active:"discount",
          aclist:[],
          page:1,
          url:shopimgUrl,
          speList:"",
          errorImg: 'this.src="../../image/default.png"'

        },
        created:function(){
          var that=this
          getData('/shop/categories?id=67',(data)=>{
              if(data.code==200){
                this.speList=data.data
              }
              else{
                api.toast({
                    msg: data.messaga,
                    duration: 2000,
                    location: 'bottom'
                });

              }
          },{},{'Authorization':$api.getStorage('token')})
          getData('/shop/ad_manages',function(data){

            that.$nextTick(function(){
              if(data.data.imgs&&data.data.imgs!='undefined'){
                data.data.imgs.forEach(item=>{
                  $('.swiper-wrapper').append('<div class="swiper-slide single" onclick="activityInner('+item.link_target_id+','+item.link_target_type+')">'
                        +'<img src="'+that.url+item.img+'" alt="">'
                    +'</div>')
                })
                var mySwiper = new Swiper('.swiper-container',{
                effect : 'slip',
                slidesPerView: 1,
                autoplay:2000,
                loop:true,
                centeredSlides: true
              } )
              }


            })
          },{'name':"商品分类轮播",'category_id':67},{'Authorization':$api.getStorage('token')})
          api.addEventListener({
            name: 'scrolltobottom'
          }, function(ret, err){

            that.loadmore()

            });

          this.getDiscount()
        },
      methods:{
        loadmore(){
          var that=this
          this.page++
          if(this.active=='brand'){
              this.init()
          }
          else if(this.active=='discount'){
            this.getDiscount()
          }
          else if(this.active=='getSpecial'){
            this.getSpecial()
          }
        },

        content(id){
          api.openWin({
              name: 'allgoods',
              url: '../../html/market/allGoodsWin.html',
              pageParam: {
                  id: id
              }
          });

        },
        getDiscount(){
          var that = this
          api.showProgress({
              style: 'default',
              animationType: 'fade',
              title: '努力加载中...',
              text: '先喝杯茶...',
              modal: false
          });
          getData('/shop/categories/category_goods?id=67',function(data){
            api.hideProgress();
            if(data.code==200){
              data.data.forEach(item=>{
                that.aclist.push(item)
              })
            }
            else{
              api.toast({
                  msg: data.message,
                  duration: 2000,
                  location: 'bottom'
              });

            }
          },{'type':4,'page':that.page,'page_size':10},{'Authorization':$api.getStorage('token')})
        },
          getSpecial(){
            var that=this
            api.showProgress({
                style: 'default',
                animationType: 'fade',
                title: '努力加载中...',
                text: '先喝杯茶...',
                modal: false
            });

            getData('/shop/categories/category_goods?id=67&commend_id=1,3',function(data){
              api.hideProgress();
              if(data.code==200){
                data.data.forEach(item=>{
                  that.aclist.push(item)
                })
              }
              else{
                api.toast({
                    msg: data.message,
                    duration: 2000,
                    location: 'bottom'
                });

              }
            },{'type':4,'page':that.page,'page_size':10},{'Authorization':$api.getStorage('token')})
          },
        init(){
          var  that =this
          api.showProgress({
              style: 'default',
              animationType: 'fade',
              title: '努力加载中...',
              text: '先喝杯茶...',
              modal: false
          });
            getData('/shop/categories/category_goods?id=67&commend_id=2,4',function(data){
              api.hideProgress();
              if(data.code==200){
                data.data.forEach(item=>{
                  that.aclist.push(item)
                })
              }
              else{
                api.toast({
                    msg: data.message,
                    duration: 2000,
                    location: 'bottom'
                });

              }
            },{'type':4,'page':that.page,'page_size':10},{'Authorization':$api.getStorage('token')})
        },
        inner(id){
          api.openWin({
              name: 'goodsInner',
              url: '../../html/market/goodsInnerWin.html',
              pageParam: {
                  id: id
              }
          });
        },
        navchange(name){
          this.page=1
          this.aclist=[]

          var that = this
          this.active=name
          if(name=='brand'){
            this.init()
          }
          else if(name=='special'){
            this.getSpecial()
          }
          else if(name=="discount"){
            this.getDiscount()
          }
        }

      }
      })


  }

  </script>
  </html>
