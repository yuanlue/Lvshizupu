<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width"/>
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>Hello APP</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css"/>

	<style>

  .market{
  	padding-bottom:50px;
  	min-height: 100vh;
  	overflow: hidden;
  	background-color: #f5f4f4;
  }
  .market>.banner{
    text-align: center;
  	position: relative;
    min-height:150px;
  	height:auto;
  }
  .market>.banner .single{
    min-height: 100px;
  }
  .market>.banner img{
width:100%;
  }
  .market .search {
    box-sizing: border-box;
  	line-height:45px;
  	padding:0 10px;
    z-index:9999;
  	position: absolute;
  	width:100%;
  	bottom:-15px;
  }
  .market .search input{
    background: white;
  	text-align: center;
  	font-size:14px;
  	border-radius: 20px;
  	box-shadow: 1px 1px 5px #ccc;
    border-bottom:1px solid #ccc;
    -webkit-box-shadow:1px 1px 5px #ccc;
  	width:100%;
  	line-height: 45px;
  }
  .market .menu{
  	background-color: white;
  	margin-top:10px;
  	padding:20px 10px;
  }
  .market .menu ul {
  	font-size:0;
  }
  .market .menu ul li img{
  	width:40px;
  }
  .market .menu ul li{
    vertical-align: top;
  	margin-top:10px;
  	text-align: center;
  	display: inline-block;
  	width:20%;
  }
  .market .menu ul li p{
  	margin-top:10px;
  	font-size:13px;
  	text-align: center;
  }
  .market header{
  	height:42px;
  	color:white;
  	line-height: 42px;
  	width:100%;
  	text-align: center;
  		margin-bottom:10px;

  }
  .market header span{
  	font-size:15px;
  }

  .market .visit header{
  	background: url("../../image/guangshangchang.png") no-repeat;
  	background-size: cover;
  }
  .market .visit img{
    width:100%;
  }
  .market .recom{
  	margin-top:10px;
  }
  .market .recom header{
  		background: url("../../image/tuijian.png") no-repeat;
  	background-size: cover;
  }
  .market .limTime header{
  		background: url("../../image/xianshi.jpg") no-repeat;
  	background-size: cover;
  }
  .market .like header,.market .special header{
  	margin-top:.26666667rem/* 20px */;
  		background: url("../../image/cainixihuan.png") no-repeat;
  	background-size: cover;
  }
  .market .visit ul{
  	border-bottom:1px solid #efebeb;
  	font-size:0;
  }
  .market .visit ul>li{
    padding:10px;
    vertical-align: top;
    font-size:0;
  	overflow: hidden;
  	background:white;
  	border-right:1px solid #efebeb;
  	height: 110px;
  	display: inline-block;
  	box-sizing: border-box;
  	width:50%;
  	  border-collapse:collapse;

  }
    .market .visit ul>li>p{
      display: inline-block;
      font-size:13px;
      color:#333333;
      margin-top:10px;
      width:40%;
      vertical-align: top;
    }
    .market .visit ul>li>img{
      width:60%;
      display: inline-block;
    }
    .market .visit ul>li span{
      color:#999999;
      display: block;
      font-size:11px;
    }
  .market .visit ol{
  	border-bottom:1px solid #efebeb;
  	font-size:0;
  }
  .market .visit ol>li{
    padding-top:10px;
      vertical-align: top;
  	overflow: hidden;
  	background:white;
  	  border-collapse:collapse;
  	border-right:1px solid #efebeb;
  	height: 150px;
  	display: inline-block;
  	box-sizing: border-box;
  	width:25%;
    font-size:13px;
    color:#333;
  }
    .market .visit ol>li>p{
      text-align: center;
    }
    .market .visit ol>li>p span{
      display: block;
      color:#999999;
      font-size:11px;
    }
  .market .visit ul>li img{
  }
  .market .recom ul{
  	width:100%;
  	white-space:nowrap;
  	height:180px;
  	overflow: auto;
  }
  .market .recom ul li{

  	line-height: 1.5;
    margin-left:10px;
  	vertical-align: top;
  		  border-collapse:collapse;
  	display: inline-block;
  	background-color: white;
  	width:115px;
  	padding:10px;
  	height:160px;
  }
  .market .recom ul li p{
    margin-top:10px;
    white-space:nowrap;
    text-overflow:ellipsis;
    overflow: hidden;
  	font-size:12px;
  }
  .market .recom ul li span{
  	font-size:15px;
  	color:#ef5737;
  }
  .market .recom ul li i {
  	font-size:12px;
  }
  .market .recom ul li img{
  	width:100%;
  }
  .market .recom ul li >div{
    overflow: hidden;
    height:100px;
  }
  .market .limTime>div {
  	padding:0 10px;
  	margin-bottom:15px;
  }
  .market .limTime>div img{
  	width:15px;
  	vertical-align: middle;
  }
  .market .limTime>div span{
  	height: 16px;
  	line-height: 16px;
  	border-radius: 10px;
  	background-color: #ef5836;
  	display: inline-block;
  	width:22px;
  	text-align: center;
  	color:white;
  }
  .market .like>ul{
  	padding:0 10px;
  	font-size:0;
  }
  .market .like img{
  	width:100%;
    height:100%;
  }
   .market .special{

     height:300px;
     width:100%;
     background-position: 0 40px;;
     background-size: 100% 129px;
     background-image: url('../../image/market/backspecial.jpg');
      background-repeat: repeat-y;
   }
   .market .special ul{

     width:100%;
     white-space:nowrap;
     height:130px;
     overflow: auto;
     margin-top:70px;
   }
   .market .special ul li p{
     font-size:14px;
     color:#ef5737;
     text-align: center;
   }
   .market .special ul li:nth-child(1){
     margin-left:10px;
   }
   .market .special ul li{
     border-right:1px solid #eee;
   	line-height: 1.5;
   	vertical-align: top;
   		  border-collapse:collapse;
   	display: inline-block;
   	background-color: white;
   	width:100px;
   	padding:5px;
   	height:110px;
   }
   .market .special ul li p{
     margin-top:10px;
     white-space:nowrap;
     text-overflow:ellipsis;
     overflow: hidden;
   	font-size:12px;
   }
   .market .special ul li span{
   	font-size:15px;
   	color:#ef5737;
   }
   .market .special ul li i {
   	font-size:12px;
   }
   .market .special ul li img{
   	width:100%;
   }
   .market .special ul li >div{
     text-align: center;
     overflow: hidden;
     height:80px;
   }
  .market .like header,  .market .special header{
    background:url(../../image/cainixihuan.png) no-repeat;
    background-size: cover;
    margin-top:10px;
  }
    .market .newsea header {
      background: url("../../image/guangshangchang.png") no-repeat ;
      background-size: cover;
    }
  .market .like>ul li{
    position: relative;
    vertical-align: middle;
  	display: inline-block;
  	width:48%;
  	margin:10px 1% 0;
  	color:#333333;
  	height:250px;
  	background-color: white;
  	box-sizing:border-box;
  	border-collapse: collapse;
  	font-size:13px;
  }
  .market .like>ul li>div{
  	height:145px;
    overflow: hidden;
    padding:10px;
  }
  .market .like>ul li p{
    overflow : hidden;
text-overflow: ellipsis;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
  	font-weight: bold;
  	padding:0 10px;
  	line-height: 20px;
    height:40px;
  }
  .market .like>ul li span{
  	color:#ef5737;
    margin-left:10px;
  	font-size:15px;
  }
  .qidai {
    text-align: center;
  }
  .qidai img{
    width:100%;
  }
  del{
    color:#999;
    font-size:12px;
  }

  .market header>span:after{
    content:"";
    margin-left:5px;
    height:10px;
    display: inline-block;
    background: url('../../image/market/left-header.png') no-repeat;
    background-size: cover;
    width:40px;
  }
  .market header>span:before{
    content:"";
    margin-right:5px;
    height:10px;
    display: inline-block;
    background: url('../../image/market/right-header.png') no-repeat;
    background-size: cover;
    width:42px;
  }
  .popup{
    z-index:2001;
    background: rgba(0,0,0,0.5);
    position: fixed;;
    top:0;
    width:100vw;
    display: none;
    height:100vh;
  }
  .market ul li  .saleNum{
    line-height: 1;
    font-weight: normal !important;
    margin-top:0 !important;
    font-size:12px;
    color:#ccc;
  }
    .market>.like ul li .label{
      font-size:0;
      position: absolute;
      left:0;
      top:0;
    }
  .market>.like ul li  .discountLabel{
    margin:0;

    font-size:12px;
     padding: 4px 8px;
     color:#fff;
     background: #ef5737;
  }
  .market>.like ul li  .specialCount{
    background:#dab611
  }
  .market>.like ul li .presallerLabel{
    background: #a88462;
  }
  .market>.like ul li  .litmitLabel{
    background: #9e2831
  }
  .market .activity-redbag{
    position: fixed;
    bottom:100px;
    right:0;
    display: inline-block;
  }
  .market .activity-redbag .img-redslide{
    width:20px;
  }
  .market .activity-redbag .img-redbag{
    width:30px;
    z-index:-1;
    top:15px;
    position: absolute;
    right:5px;
  }
  [v-cloak]{
    display: none
  }

	</style>
</head>
<body>
  <div class="market" >
  <div class="banner ">
    <div class="swiper-container">
    <div class="swiper-wrapper">

      </div>
    </div>

  <div class="search" @click="search()">
    <input type="text" placeholder="请输入商品／店铺名">
  </div>
  </div>
  <div class="menu">
    <ul>
    <li @click="all('all')">
      <img src="../../image/Mclassify.png" alt="">
        <p>全部分类</p>
      </li>

      <li @click="all('cart')">
        <img src="../../image/cart.png" alt="">
        <p>购物车</p>
      </li>
      <li @click="all('myorder')">
        <img src="../../image/order.png" alt="">
        <p>我的订单</p>
      </li>
      <li @click="all('specialty')">
        <img src="../../image/techanicon.png" alt="">
        <p>特产专区</p>
      </li>
      <li @click="all('presaller')">
        <img src="../../image/presaller.png" alt="">
        <p>预售中心</p>
      </li>
      <li @click="all('myVoucher')" style="display:none" >
        <img src="../../image/kaquanbao.png" alt="">
        <p>卡券包</p>
      </li>
      <li @click="all('myfoot')" >
        <img src="../../image/Mfoot.png" alt="">
        <p>我的足迹</p>
      </li>
      <li @click="all('recommend')">
        <img src="../../image/Mgoods.png" alt="">
        <p>推荐商品</p>
      </li>
      <li @click="all('discount')" >
        <img src="../../image/Mdiscount.png" alt="">
        <p>折扣专区</p>
      </li>
      <li @click="all('litmitGoods')">
        <img src="../../image/Mtime.png" alt="">
        <p>限时秒杀</p>
      </li>
      <li @click="all('collection')" >
        <img src="../../image/Mshoucang.png" alt="">
        <p>我的收藏</p>
      </li>
      <li @click="all('voucherCenter')" style="display:none">
        <img src="../../image/lingquan.png" alt="">
        <p>领券中心</p>
      </li>

    </ul>
  </div>
  <div class="visit" v-cloak>
    <header><span>逛商场</span></header>
    <ul>
      <li @click="allContent(item.id,item.name,index)" v-for="(item,index) in sortList" v-if="index<2">
        <p>{{item.name}}
          <span>{{item.desc}}</span>
        </p>
        <img v-for="p in item.ads" v-bind:src="url+p.img" :error="errorImg" alt="">
      </li>

    </ul>
    <ol>
      <li @click="allContent(item.id,item.name,index)" v-for="(item,index) in sortList" v-if="index>=2">
        <p>{{item.name}}
          <span>{{item.desc}}</span>
        </p>
        <img v-for="p in item.ads" v-bind:src="url+p.img" alt="" :error="errorImg">

      </li>
    </ol>
  </div>
  <div class="special" v-cloak>
  <header  @click="sepcial('specialty')"><span>特产专区</span></header>
  <ul>
    <li v-for="item in speGoods" @click="inner(item.id)">
        <div>
        <img v-if="item.img" v-bind:src="url+item.img" alt="" :onerror="errorImg">
        <img v-if="!item.img" src="../../image/default.png">

        </div>
        <p>{{item.sell_price}}</p>
      </li>
  </ul>

</div>

      <div class="recom" v-cloak>
    <header @click="all('recommend')"><span>推荐商品</span></header>
    <ul>
      <li v-for="item in recomGoods" @click="inner(item.id)">
  				<div>
  				<img v-if="item.img" v-bind:src="url+item.img" alt="" :onerror="errorImg">
          <img v-if="!item.img" src="../../image/default.png">

  				</div>
  				<p>{{item.name}}</p>

  				<span><i>￥</i>{{item.sell_price}}</span>
          <p class="saleNum">销量：{{item.sale}}</p>

  			</li>
    </ul>

  </div>
    <div class="limTime recom" v-cloak v-if="timeGoods.length>0">
    <header><span>限时秒杀</span></header>
    <div>
      <p style="display:none">
        <img src="../../image/littime.png" alt="">
        16点场
        <span>26</span>:<span>00</span>:<span>00</span>
      </p>

    </div>
    <ul>
      <li v-for="item in timeGoods" @click="inner(item.id)" >
    				<div>
    				<img v-bind:src="url+item.img" alt="" :onerror="errorImg">
    				</div>
    				<p>{{item.name}}</p>
    				<span><i>￥</i>{{item.award_value}}</span>
            <p class="saleNum">销量：{{item.sale}}</p>

    			</li>
    </ul>

  </div>
    <div class="like" v-cloak >
    <header><span>猜你喜欢</span></header>

    <ul>
      <li v-for="item in likeGoods" @click="inner(item.id)">
  					<div>
  				<img v-bind:src="url+item.img" alt="" :onerror="errorImg">
  				</div>
  				<p>{{item.name}}</p>
  				<span><i>￥</i>{{item.sell_price}}</span>
          <del>{{item.market_price}}</del>
          <p class="saleNum">销量：{{item.sale}}</p>

  			</li>

    </ul>

  </div>
  <div class="like newsea" v-cloak >
  <header><span>新品海淘</span></header>

  <ul>
    <li v-for="item in newGoods" @click="inner(item.id)">
      <div class="label">
        <span class="discountLabel litmitLabel" v-if="item.flash_type==1">限时抢购</span>
        <span class="discountLabel specialCount" v-if="item.other_type==2">分类特价</span>
        <span class="discountLabel specialCount" v-if="item.other_type==3">单品特价</span>
        <span class="discountLabel specialCount" v-if="item.other_type==4">品牌特价</span>
        <span class="discountLabel presallerLabel" v-if="item.presale">预售</span>
      </div>


          <div>
        <img v-bind:src="url+item.img" alt="" :onerror="errorImg">
        </div>
        <p>{{item.name}}</p>
        <span><i>￥</i>{{item.sell_price}}</span>
        <del>{{item.market_price}}</del>
        <p class="saleNum">销量：{{item.sale}}</p>

      </li>
  </ul>

</div>
  <span class="activity-redbag" style="display:none" @click="getred()">
    <img class="img-redbag" src="../../image/market/redbug.png" alt="">
    <img class="img-redslide" src="../../image/market/redbagSlide.png" alt="">
  </span>
</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../script/service.js"></script>
<script type="text/javascript" src="../../script/vue.js"></script>
<script type="text/javascript" src="../../script/swiper-3.4.2.min.js"></script>

<script type="text/javascript">

  function activityInner(id,type){
    let name
    switch (type) {
      case 1:////"1" =>店铺
        name="shopintro"
        break;
      case 2: ////"2" =>商品分类
        name="allGoods"
        break;
      case 3:
        name="goodsInner"
        break; //"3" =>商品单品
      case 4: //"4" =>商品品牌
        break
      case 5: ////"5" =>营销活动
        name="litmitGoods"
        break
    }
    api.openWin({
        name: name,
        url: '../../html/market/'+name+'Win.html',
        pageParam: {
            id: id
        }
    });

  }
    apiready = function(){
      // 融云模块
       app=new Vue({
        el: '.market',
        data: {
          url:shopimgUrl,
          timeGoods:[],
          recomGoods:[],
          likeGoods:[],
          speGoods:[],
          redBagInfo:"",
          newGoods:[],
          page:0,
          errorImg: 'this.src="../../image/default.png"',
          sortList:[]
        },
        mounted(){
          api.hideProgress();
        },
        created:function(){
          api.showProgress({
              style: 'default',
              animationType: 'fade',
              title: '努力加载中...',
              text: '先喝杯茶...',
              modal: false
          });

          var that = this
          this.init()
          getData('/shop/categories',(data)=>{
            let arr=[]

            data.data.forEach((item,index)=>{
              if(index<=5){
                fetch({
                  url:"/shop/ad_manages",
                  method:"get",
                  params:{'name':'逛商场广告位'+(index+1)}
                }).then(res=>{
                  item.ads=res.data.imgs
                    arr.push(item)
                }).catch(function(error) {
                  console.log('error: ' + console.log(JSON.stringify(error)));
                });

              }
            })
              this.sortList=arr
          },{},{'Authorization':$api.getStorage('token')})
          getData('/shop/ad_manages',function(data){
            console.log(JSON.stringify(data))
            that.$nextTick(function(){
              if(!data.data.imgs||data.data.imgs=='undefined'){
                $('.swiper-wrapper').append('<div class="swiper-slide single"  >'
                      +'<img src="../../image/default.png" alt="">'
                  +'</div>')
              }
              else{
                data.data.imgs.forEach(item=>{
                  $('.swiper-wrapper').append('<div onclick="activityInner('+item.link_target_id+','+item.link_target_type+')" class="swiper-slide single">'
                        +'<img src="'+that.url+item.img+'" alt="">'
                    +'</div>')
                })
              }
              var mySwiper = new Swiper('.swiper-container',{
              autoplay:2000,
              loop:true
            } )
            })
          },{'name':'首页顶部广告'},{'Authorization':$api.getStorage('token')})

          api.setCustomRefreshHeaderInfo({
          bgColor: '#eee',
          images: [
              'widget://image/refresh/dropdown0.png',
              'widget://image/refresh/dropdown1.png',
              'widget://image/refresh/dropdown2.png',
              'widget://image/refresh/dropdown3.png',
              'widget://image/refresh/dropdown4.png',
              'widget://image/refresh/dropdown5.png',
              'widget://image/refresh/dropdown6.png'
          ],
          tips: {
              pull: '下拉刷新',
              threshold: '松开立即刷新',
              load: '正在刷新'
          }
      }, function() {
          //下拉刷新被触发，自动进入加载状态，使用 api.refreshHeaderLoadDone() 手动结束加载中状态
          //下拉刷新被触发，使用 api.refreshHeaderLoadDone() 结束加载中状态
            that.init()


      });
          api.addEventListener({
            name: 'scrolltobottom'
          }, function(ret, err){

            that.loadmore()

            });
        },
      methods:{

        allContent(id,name,index){
          api.openWin({
              name: 'allgoods',
              url: '../../html/market/allGoodsWin.html',
              pageParam: {
                  id: id,
                  name:name,
                  index:index+1
              }
          });
        },
        getred(){//领取红包
          getData('/shop/red_packets',res=>{
            if(res.code!=200){
              api.toast({
                  msg: res.message,
                  duration: 2000,
                  location: 'bottom'
              });
              return
            }
            console.log(JSON.stringify(res.data[0]))
            if(!res.data){
              api.toast({
                  msg: '当前红包不存在',
                  duration: 2000,
                  location: 'bottom'
              });
              return
            }
            this.redBagInfo=res.data[0]
            api.openFrame({
                name: 'redbag',
                url: '../../html/market/redbag.html',
                rect: {
                    x: 0,
                    y: 0,
                    w: 'auto',
                    h: 'auto'
                },
                pageParam: {
                    redBagInfo: this.redBagInfo
                },
                bounces: false,
                bgColor: 'rgba(0,0,0,0.5)',
                vScrollBarEnabled: true,
                hScrollBarEnabled: true
            });

          },{'page_size':1,'page':1},{'Authorization':$api.getStorage('token')})
        },
        foot(){
          api.openWin({
              name: 'myfootWin',
              url: '../../html/market/myfootWin.html'
          });

        },
        all(name){
          api.openWin({
              name: name,
              url: '../../html/market/'+name+'Win.html',
              bounces:false

          });

        },

        loadmore(){
          var that = this
          that.page++
          api.showProgress({
              style: 'default',
              title: '努力加载中...',
              text: '先喝杯茶...',
              modal: false
          });
          getData('/shop/goods',function(data){
            api.hideProgress();

            if(data.code==200){
              data.data.forEach(function(item){
                that.newGoods.push(item)
              })
            }
          },{'page':that.page,'page_size':4},{'Authorization':$api.getStorage('token')})

        },
          init(){
            var that =this
            that.timeGoods=[],
            that.recomGoods=[],
            that.likeGoods=[]
            that.page=1;

            getData('/shop/goods',function(data){
              if(data.code==200){
                  that.newGoods=data.data

              }
            },{'page':that.page,'page_size':4},{'Authorization':$api.getStorage('token')})
            getData('/shop/categories/category_goods',function(data){
              if(data.code==200){
                that.speGoods=data.data
              }
            },{'id':67,'page':1,'page_size':4},{'Authorization':$api.getStorage('token')})
            getData('/shop/goods/promotions/flash_sale',function(data){
              if(data.code==200){
                that.timeGoods=data.data
              }
            },{},{'Authorization':$api.getStorage('token')})
            getData('/shop/goods/guess_favorites?page=1&page_size=4',function(data){
              if(data.code==200){
                that.likeGoods=data.data
                api.hideProgress();


              }
            },{page:1,page_size:4},{'Authorization':$api.getStorage('token')})
            getData('/shop/goods/promotions/commend_goods?commend_id=4&page=1&page_size=6',function(data){
              if(data.code==200){
                that.recomGoods=data.data
                api.refreshHeaderLoadDone()

              }
            },{},{'Authorization':$api.getStorage('token')})
          },
          search(){
            var UISearchBar = api.require('UISearchBar');
              UISearchBar.open({
                  placeholder: '请输入搜索关键字',
                  historyCount: 10,
                  showRecordBtn: false,
                  texts: {
                      cancelText: '取消',
                      clearText: '清除搜索记录'
                  },
                  styles: {
                      navBar: {
                          bgColor: '#9e2932',
                          borderColor: '#ccc'
                      },
                      searchBox: {
                          bgImg: '',
                          color: '#000',
                          height: 40
                      },
                      cancel: {
                          bg: 'rgba(0,0,0,0)',
                          color: '#fff',
                          size: 16
                      },
                      list: {
                          color: '#696969',
                          bgColor: '#FFFFFF',
                          borderColor: '#eee',
                          size: 16
                      },
                      clear: {
                          color: '#9e2932',
                          borderColor: '#ccc',
                          size: 16
                      }
                  }
              }, function(ret, err) {
                  if (ret) {
                    if(ret.eventType=="search"||ret.eventType=="history"){
                      api.openWin({
                          name: 'searchresultWin',
                          url: '../../html/market/searchresultWin.html',
                          pageParam: {
                              name: ret.text
                          }
                      });
                    }
                  } else {

                  }
              });
          },
          sepcial(){
            api.openWin({
                name: 'specialtyWin',
                url: '../../html/market/specialtyWin.html'

            });
          },
          inner(id){
            api.openWin({
                name: 'goodsInner',
                url: '../../html/market/goodsInnerWin.html',
                pageParam: {
                    id: id
                }
            });

          },
          content(name){
            api.openWin({
                name: 'Mcontent',
                url: '../../html/market/contentWin.html',
                pageParam: {
                    name: name
                }
            });

          }


      }
      })


}

</script>
</html>
