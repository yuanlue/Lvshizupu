<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
      <link rel="stylesheet" type="text/css" href="../../css/swiper-3.4.2.min.css"/>

      <style>
          body{
          min-height:100vh;
          background-color: #f3f1f1;
          }
          .banner{
            width:100%;
            min-height:150px;
            padding-bottom:10px;
            background: -webkit-linear-gradient(to bottom,#e85f2d,#bf2a0a);
                  background: -o-linear-gradient(to bottom,#e85f2d,#bf2a0a);
                  background: -moz-linear-gradient(to bottom,#e85f2d,#bf2a0a);
                  background: -mos-linear-gradient(to bottom,#e85f2d,#bf2a0a);
                  background: linear-gradient(to bottom,#e85f2d,#bf2a0a);
          }
          .single{
            padding:0 10px;
            box-sizing: border-box;
            text-align: center;
            width:100%;
          }
          .single img{
            width:100%;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
          }
          .discountArea .tab {
            background-color: white;
          }
          .discountArea .tab ul{
            display: table;
            width:100%;
          }
          .discountArea .tab ul>li{
            padding-top: 12px;
            text-align: center;
            display: table-cell;
            font-size:14px;
          }
          .discountArea .tab ul>.active{
            border-bottom:2px solid #e85f2d;
          }
          .discountArea .tab ul>li p{
            line-height: 32px;
          }
          .discountArea .tab ul>li img{
            width:35px;
          }
          .discountArea .goodsList {
            margin-top:10px;
          }
          .discountArea .goodsList>li{
            position: relative;;
            background: url('../../image/market/backLi.png');
            width:100%;
            height: 220px;
            background-size: cover;
            border-top-left-radius:40px;
          }
          .discountArea .goodsList>li .label{
            color:#e65c2b;
            font-size:14px;
            background-color: white;
            position: absolute;
            line-height: 60px;
            width:80px;
            text-align: center;
            border-bottom-left-radius:20px;
            border-bottom-right-radius:20px;
            top:0;
            right:10px;
          }
          .discountArea .goodsList>li {
            margin-bottom:10px;
          }
          .discountArea .goodsList>li .label i{
            font-size:18px;
            font-weight: bold;
            font-style: normal;
          }
          .discountArea .goodsList>li  header span{
            position: relative;
            margin-left:10px;
            line-height: 30px;
          }
            .discountArea .goodsList>li header  span:before{
            position: absolute;
            content:"";
            width:35px;
            height:2px;
            background: #c5867a;
            }
          .discountArea .goodsList>li header img{
            border-radius: 50%;
            vertical-align: middle;
            width:40px;
            height:40px;
            border:2px solid rgba(255,255,255,0.3)
          }
          .discountArea .goodsList>li header{
            color:#a86053;
            padding:15px 15px 0;
            vertical-align: middle;
            font-size:16px;
          }
            .discountArea .goodsList>li>ol {
              padding:0 10px;
              margin-top:15px;

              box-sizing: border-box;
            }
            .discountArea .goodsList>li>ol li>div{
              height:90px;
              box-sizing: border-box;
              position: relative;
              padding:0 5px;

              background-color: white;
              overflow: hidden;
            }
            .discountArea .goodsList>li>ol li img{
              position: absolute;
              top:0;
              left:0;
              width:100%;
            }
            .discountArea .goodsList>li>ol li p{
              padding:0 5px;
              background: white;
              line-height: 40px;
              font-size:15px;
              color:#ef5737;
              font-weight: bold;
            }
            .discountArea .goodsList>li>ol li p del{
              margin-left: 10px;
              font-size:10px;
              color:#999;
            }
            .discountArea .goodsList>li>ol li p i{
              font-style: normal;
              font-size:10px;
            }
            .discountArea .goodsList>li>ol li{

              font-size:0;
              padding:0 2px;
              width:32%;
                display: inline-block;;
            }
            .discountArea .goodsList>li>ol{
              width:100%;
            }
            .discountArea .discountList {
              margin-top:10px;
              padding:0 15px;
            }

            .discountArea .discountList li{
              padding-top:20px;
              position: relative;
              background: #f8dfd6;
              border-bottom-right-radius: 40px;
              box-sizing: border-box;
              padding-left:15px;
              width:100%;
              height:100px;


            }
            .discountArea .discountList li  .label{
              line-height: 20px;
              font-size: 15px;
              font-weight: bold;
              color:#333333;
            }
            .discountArea .discountList li  .label i{
              font-size:24px;
              color:#ef5737;
              font-style: normal;
            }
            .discountArea .discountList li  .label img{
              width:15px;
              margin-left:10px;
              vertical-align: middle;
            }
              .discountArea .discountList li .ad img{
                width:60%;
              }
            .discountArea .discountList li .ad{
              overflow: hidden;
              text-align: center;
              position: absolute;
              background-color: white;
              border-bottom-right-radius: 40px;
              top:0;
              height:100px;
              width:150px;
              right:0;
              border-top-left-radius: 40px;

            }
              .discountArea .discountList li{
                margin-bottom:10px;
              }
            .discountArea .discountList li .name{
              line-height: 30px;
              color:#aa6053;
              font-size:16px;
            }
            .specialList{
              margin-top:10px;
            }
            .specialList  li>div{
              padding:15px 10px;
            }
            i{
              font-style:normal;
            }
              .specialList  li{
                background-color: white;
                border-bottom:1px solid #eee;
              }
            .specialList  li .info{
              vertical-align: top;
              width: 70%;
              margin-left:10px;
              display: inline-block;
            }
            @media screen  and (max-width: 320px) {
              .specialList  li .info{
                vertical-align: top;
                width: 60%;
                margin-left:10px;
                display: inline-block;
              }
            }
          .specialList  li img{
            width:75px;
          }
          .specialList  li .name{
            font-size:15px;
            line-height:25px
          }
            .specialList  li .price{
              margin-top:15px;
            }
            .specialList  li .price>span{
              font-size:12px;
              color:#ef5737;
            }
            .specialList  li .price del{
              font-size:12px;
              color:#999;

            }
            .specialList  li .price>span i{
              font-size: 16px;
            }
            .specialList  li .price b {
              font-size: 12px;
              font-weight: normal;
              float: right;
              color:#999;
            }
            .empty{
              margin-top:20px;
              text-align: center;
            }
            .empty img{
              width:100px;
            }
            .empty p{
              margin-top:10px;
            }
          [v-cloak]{
            display: none;
          }

      </style>
  </head>
  <body>
    <div class="discountArea" v-cloak>
      <div class="banner swiper-container">
          <div class="swiper-wrapper">
              <div class="swiper-slide single">
                <img src="../../image/market/discount_banner.png" alt="">
              </div>
              <div class="swiper-slide single">
                <img src="../../image/market/discount_banner.png" alt="">
              </div>
              <div class="swiper-slide single">
                <img src="../../image/market/discount_banner.png" alt="">
              </div>
               <div class="swiper-slide single">
                 <img src="../../image/market/discount_banner.png" alt="">
                </div>
          </div>
      </div>
      <div class="tab">
        <ul>
          <li @click="navchange('brand')" v-bind:class="{active:active=='brand'}">
            <img v-if="active=='brand'" src="../../image/market/dBrand.png" alt="">
            <img v-if="active!='brand'" src="../../image/market/adBrand.png" alt="">

            <p>品牌折扣</p>
          </li>
          <li @click="navchange('discount')" v-bind:class="{active:active=='discount'}">
            <img v-if="active=='discount'" src="../../image/market/aDiscount.png" alt="">
            <img v-if="active!='discount'" src="../../image/market/adDiscount.png" alt="">

            <p>折扣活动</p>
          </li>
          <li @click="navchange('special')" v-bind:class="{active:active=='special'}">
            <img v-if="active=='special'" src="../../image/market/aSpecial.png" alt="">
            <img v-if="active!='special'" src="../../image/market/adSpecial.png" alt="">

            <p>特价商品</p>
          </li>
        </ul>
      </div>
      <ul class="goodsList" v-if="active=='brand'">
        <li v-for="item in aclist">
          <span class="label">全场<i>{{item.award_value/10}}</i>折</span>
          <header>
            <img v-if="item.img" v-bind:src="url+item.img" alt="">
            <img v-if="!item.img" src="../../image/logo.png" alt="">
              <span @click="content(item.name,'discount',item.id)">{{item.name}}</span>
          </header>
          <ol>
            <li v-for="p in item.goods" @click="inner(p.id)">
              <div>
                  <img v-if="p.img" v-bind:src="url+p.img" alt="">
                  <img v-if="!p.img" src="../../image/default.png" alt="">
              </div>
              <p><span><i>¥</i>{{p.sell_price}}</span><del>{{p.market_price}}</del></p>
            </li>
          </ol>
        </li>
      </ul>
      <ul class="discountList" v-if="active=='discount'">
        <li v-for="item in aclist" @click="content(item.name,'discount',item.id)">
            <div class="info">
              <span class="name" >{{item.name}}</span>
              <p class="label">全场<i>{{item.award_value/10}}</i>折<img src="../../image/market/stepin.png" alt=""></p>
            </div>
            <div class="ad">
              <img v-if="!item.img"  src="../../image/default.png" alt="">
              <img v-if="item.img"  v-bind:src="url+item.img" alt="">
            </div>
        </li>
      </ul>
      <ul class="specialList" v-if="active=='special'">
        <li v-for="item in aclist" @click="inner(item.id)">
          <div>
              <img v-bind:src="url+item.img" alt="">
                <div class="info">
                    <p class="name">{{item.name}}</p>
                    <p class="price">
                      <span>￥<i>{{item.sell_price}}</i></span>
                      <del>{{item.market_price}}</del>
                      <b >已售 {{item.sale}} 件</b>
                    </p>
                </div>
                </div>
        </li>
      </ul>
      <div class="empty" v-if="aclist.length<1">
        <p>暂无数据</p>
      </div>
    </div>
  </body>
  <script type="text/javascript" src="../../script/api.js"></script>
  <script type="text/javascript" src="../../script/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="../../script/service.js"></script>
  <script type="text/javascript" src="../../script/swiper-3.4.2.min.js"></script>
  <script type="text/javascript" src="../../script/vue.js"></script>

    <script type="text/javascript">
    apiready = function(){
      // 融云模块
      var app=new Vue({
        el: '.discountArea',
        data: {
          active:"brand",
          aclist:[],
          page:1,
          url:shopimgUrl
        },
        created:function(){
          var that=this

          this.$nextTick(function(){
            var mySwiper = new Swiper('.swiper-container',{
            effect : 'slip',
            slidesPerView: 1,
            autoplay:3000,
            centeredSlides: true
          } )
          })
          api.addEventListener({
            name: 'scrolltobottom'
          }, function(ret, err){

            that.loadmore()

            });

          this.init()
        },
      methods:{
        loadmore(){
          var that=this
          this.page++
          if(this.active=='brand'){
              this.init()
          }
          else if(this.active=='discount'){
            this.getDiscount()
          }
          else if(this.active=='getSpecial'){
            this.getSpecial()
          }
        },
        content(name,type,id){
          api.openWin({
              name: 'contentWin',
              url: '../../html/market/contentWin.html',
              pageParam: {
                  name: name,
                  type:type,
                  id:id
              }
          });

        },
        getDiscount(){
          var that = this
          api.showProgress({
              style: 'default',
              animationType: 'fade',
              title: '努力加载中...',
              text: '先喝杯茶...',
              modal: false
          });

          getData('/shop/goods/promotions/discounts',function(data){
            if(data.code==200){
              api.hideProgress();
              if(that.page==1){
                that.aclist=data.data
              }else{
                data.data.forEach(function(item){
                  that.aclist.push(item)
                })
              }
            }
            else{
              api.toast({
                  msg: data.message,
                  duration: 2000,
                  location: 'bottom'
              });
            }
          },{'type':2,'page':that.page,'page_size':10},{'Authorization':$api.getStorage('token')})
        },
          getSpecial(){
            var that=this
            api.showProgress({
                style: 'default',
                animationType: 'fade',
                title: '努力加载中...',
                text: '先喝杯茶...',
                modal: false
            });

            getData('/shop/goods/promotions/special_goods',function(data){
              if(data.code==200){
                api.hideProgress();
                if(that.page==1){
                  that.aclist=data.data
                }else{
                  data.data.forEach(function(item){
                    that.aclist.push(item)
                  })
                }
              }
              else{
                api.toast({
                    msg: data.message,
                    duration: 2000,
                    location: 'bottom'
                });
              }
            },{'page':that.page,'page_size':10},{'Authorization':$api.getStorage('token')})
          },
        init(){
          var  that =this
          api.showProgress({
              style: 'default',
              animationType: 'fade',
              title: '努力加载中...',
              text: '先喝杯茶...',
              modal: false
          });

            getData('/shop/goods/promotions/discounts',function(data){
              if(data.code==200){
                data.data.forEach(function(item){
                  getData('/shop/goods/promotions/discount_goods',function(res){
                    if(res.code==200){
                      item.goods=res.data
                    }
                    else{
                      api.toast({
                          msg: data.message,
                          duration: 2000,
                          location: 'bottom'
                      });

                    }
                  },{'id':item.id,'page':1,'page_size':3},{'Authorization':$api.getStorage('token')})
                })
                api.hideProgress();
                if(that.page==1){
                  that.aclist=data.data
                }else{
                  data.data.forEach(function(item){
                    that.aclist.push(item)
                  })
                }

              }
              else{
                api.toast({
                    msg: data.message,
                    duration: 2000,
                    location: 'bottom'
                });

              }
            },{'type':4,'page':that.page,'page_size':10},{'Authorization':$api.getStorage('token')})
        },
        inner(id){
          api.openWin({
              name: 'goodsInner',
              url: '../../html/market/goodsInnerWin.html',
              pageParam: {
                  id: id
              }
          });
        },
        navchange(name){
          this.page=1
          this.aclist=[]

          var that = this
          this.active=name
          if(name=='brand'){
            this.init()
          }
          else if(name=='special'){
            this.getSpecial()
          }
          else if(name=="discount"){
            this.getDiscount()
          }
        }

      }
      })


  }

  </script>
  </html>
